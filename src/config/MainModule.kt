package config

import handlers.SimpleConnectHandler
import handlers.SimpleDisconnectHandler
import handlers.SimplePublishHandler
import io.netty.handler.codec.mqtt.MqttQoS
import io.vertx.core.Vertx
import io.vertx.mqtt.MqttClient
import io.vertx.mqtt.MqttClientOptions
import org.koin.core.qualifier.named
import org.koin.dsl.module

val mainModule = module {
    single{
        MqttClientOptions().apply {
            isAutoKeepAlive = true
            isAutoGeneratedClientId = true
        }
    }

    single {
        MqttClient.create(
            Vertx.vertx(),
            get()
        ) as MqttClient
    }

    single(named("disconnectHandler")) { SimpleDisconnectHandler }
    single(named("connectHandler")) { SimpleConnectHandler }
    single(named("publishHandler")) { SimplePublishHandler }


    //add topics to subscribe to
    single(named("topics")) {
        mapOf(
            "testTopic" to MqttQoS.AT_MOST_ONCE
        )
    }
}